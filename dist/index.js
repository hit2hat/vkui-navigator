!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports,require("react"),require("@vkontakte/vk-bridge"),require("@vkontakte/vkui"),require("@vkontakte/icons")):"function"==typeof define&&define.amd?define(["exports","react","@vkontakte/vk-bridge","@vkontakte/vkui","@vkontakte/icons"],a):a((e=e||self).app={},e.React,e.VKBridge,e.vkui,e.icons)}(this,(function(e,a,t,o,i){"use strict";var l="default"in a?a.default:a;t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,e.Page=function({activePanel:e,header:i=!0,goPage:n,isModalOpen:r,showModal:d,hideModal:s,id:c,children:p=[],pageParams:u}){const[{activePanel:h,homePanel:m,history:w,popout:b,params:v,header:y},g]=useReducer((e,a)=>({...e,...a}),{activePanel:e,homePanel:e,history:[e],popout:null,params:{},header:i}),P=()=>{if(null!==b)return g({popout:null});if(r)return f();if(1===w.length)return null;const e=w[w.length-2];e===m&&t.send("VKWebAppDisableSwipeBack",{}),g({activePanel:e,history:w.slice(0,w.length-1),popout:null,activeModal:null,modalHistory:[],modalParams:{}})},k=e=>{g({popout:e})},f=()=>{h!==m&&t.send("VKWebAppEnableSwipeBack",{}),s()};a.useEffect(()=>(t.send("VKWebAppDisableSwipeBack",{}),window.addEventListener("popstate",P),window.history.replaceState({panel:m},m),()=>{window.removeEventListener("popstate",P);for(let e=0;e<w.length-1;e++)window.history.back()}),[]);const E={go:(e,a={})=>{h===m&&t.send("VKWebAppEnableSwipeBack",{}),window.history.pushState({panel:e,modal:null},e),g({activePanel:e,history:[...w,e],popout:null,params:a})},goPage:n,goBack:window.history.back.bind(window.history),showModal:(e,a={})=>{t.send("VKWebAppDisableSwipeBack",{}),window.history.pushState({panel:h,modal:e},h),d(e,a)},hideModal:()=>window.history.back,showPopout:k,showLoader:()=>{k(l.createElement(o.ScreenSpinner,null))},hideLoader:()=>{k(null)},showDialog:({title:e,description:a,buttonText:t,action:i})=>{k(l.createElement(o.Alert,{actionsLayout:"vertical",actions:[{title:t||"Удалить",action:i,style:"destructive"},{title:"Отмена",autoclose:!0,style:"cancel"}],onClose:()=>k(null)},l.createElement("h2",null,e),l.createElement("p",null,a)))},showAlert:({title:e,description:a})=>{k(l.createElement(o.Alert,{actions:[{title:"Закрыть",autoclose:!0,style:"cancel"}],onClose:()=>k(null)},l.createElement("h2",null,e),l.createElement("p",null,a)))},headerVisible:e=>{g({header:e})}};return l.createElement(o.View,{id:c,activePanel:h,history:w,popout:b,header:y,onSwipeBack:window.history.back.bind(window.history)},l.Children.map(p,e=>l.cloneElement(e,{id:e.props.id,navigator:{...E,params:e.props.id===h?{...v,pageParams:u}:{}}})))},e.Stack=function({activePage:e,modals:n=[],children:r,modal:d,disabledConfigProvider:s,webviewType:c,scheme:p,isWebView:u,transitionMotionEnabled:h,appearance:m}){const[{modalHistory:w,activeModal:b,modalParams:v,activePage:y,pageParams:g},P]=a.useReducer((e,a)=>({...e,...a}),{activePage:e,activeModal:null,modalHistory:[],modalParams:{},pageParams:{}}),k=(e,a)=>{t.send("VKWebAppDisableSwipeBack",{}),P({activePage:e,pageParams:a})},f=(e,a)=>{P({activeModal:e,modalHistory:w.includes(e)?w.splice(0,w.indexOf(e)+1):[...w,e],modalParams:a})},E=()=>{P({activeModal:null,modalHistory:[]})},M={goPage:k,showModal:f,hideModal:E},S=l.createElement(o.Root,{activeView:y,modal:0===n.length?null:l.createElement(o.ModalRoot,{activeModal:b,children:l.Children.map(n,e=>l.cloneElement(e,{...e.props,onClose:window.history.back.bind(window.history),header:l.createElement(o.ModalPageHeader,{left:o.platform()===o.ANDROID&&l.createElement(o.PanelHeaderButton,{onClick:window.history.back.bind(window.history),children:l.createElement(i.Icon24Cancel,null)}),right:o.platform()===o.IOS&&l.createElement(o.PanelHeaderButton,{onClick:window.history.back.bind(window.history),children:l.createElement(i.Icon24Dismiss,null)}),children:e.props.title||""}),navigator:{...M,params:e.props.id===b?v:{}}}))})},l.Children.map(r,e=>l.cloneElement(e,{id:e.props.id,showModal:f,hideModal:E,goPage:k,isModalOpen:null!==b,pageParams:g})));return s?S:l.createElement(o.ConfigProvider,{webviewType:c,isWebView:u,scheme:p,transitionMotionEnabled:h,appearance:m},S)},e.Tabbar=function({activeStory:e,id:t,children:i,showModal:n,hideModal:r,goPage:d,isModalOpen:s,pageParams:c}){const[{activeStory:p},u]=a.useReducer((e,a)=>({...e,...a}),{activeStory:e}),h=({currentTarget:e})=>{u({activeStory:e.dataset.story})};return l.createElement(o.Epic,{id:t,activeStory:p,tabbar:(m=i,l.createElement(o.Tabbar,null,l.Children.map(m,(e,a)=>l.createElement(o.TabbarItem,{key:a,onClick:h,selected:p===e.props.id,"data-story":e.props.id,text:e.props.title||"",children:e.props.icon||null,label:e.props.label||""}))))},l.Children.map(i,e=>l.cloneElement(e,{...e.props,goPage:d,showModal:n,hideModal:r,isModalOpen:s,pageParams:c})));var m},Object.defineProperty(e,"__esModule",{value:!0})}));
