!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports,require("react"),require("@vkontakte/vk-bridge"),require("@vkontakte/vkui"),require("@vkontakte/icons")):"function"==typeof define&&define.amd?define(["exports","react","@vkontakte/vk-bridge","@vkontakte/vkui","@vkontakte/icons"],a):a((e=e||self).app={},e.React,e.VKBridge,e.vkui,e.icons)}(this,(function(e,a,t,o,l){"use strict";a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,e.Page=function({activePanel:e,header:l=!0,goPage:n,isModalOpen:i,showModal:r,hideModal:d,id:s,children:c=[],pageParams:p}){const[{activePanel:u,homePanel:h,history:m,popout:w,params:b,header:y},v]=a.useReducer((e,a)=>({...e,...a}),{activePanel:e,homePanel:e,history:[e],popout:null,params:{},header:l}),g=()=>{if(null!==w)return v({popout:null});if(i)return k();if(1===m.length)return null;const e=m[m.length-2];e===h&&t.send("VKWebAppDisableSwipeBack",{}),v({activePanel:e,history:m.slice(0,m.length-1),popout:null,activeModal:null,modalHistory:[],modalParams:{}})},P=e=>{v({popout:e})},k=()=>{u!==h&&t.send("VKWebAppEnableSwipeBack",{}),d()};a.useEffect(()=>(t.send("VKWebAppDisableSwipeBack",{}),window.addEventListener("popstate",g),window.history.replaceState({panel:h},h),()=>{window.removeEventListener("popstate",g);for(let e=0;e<m.length-1;e++)window.history.back()}),[]);const f={go:(e,a={})=>{u===h&&t.send("VKWebAppEnableSwipeBack",{}),window.history.pushState({panel:e,modal:null},e),v({activePanel:e,history:[...m,e],popout:null,params:a})},goPage:n,goBack:window.history.back.bind(window.history),showModal:(e,a={})=>{t.send("VKWebAppDisableSwipeBack",{}),window.history.pushState({panel:u,modal:e},u),r(e,a)},hideModal:()=>window.history.back,showPopout:P,showLoader:()=>{P(a.createElement(o.ScreenSpinner,null))},hideLoader:()=>{P(null)},showDialog:({title:e,description:t,buttonText:l,action:n})=>{P(a.createElement(o.Alert,{actionsLayout:"vertical",actions:[{title:l||"Удалить",action:n,style:"destructive"},{title:"Отмена",autoclose:!0,style:"cancel"}],onClose:()=>P(null)},a.createElement("h2",null,e),a.createElement("p",null,t)))},showAlert:({title:e,description:t})=>{P(a.createElement(o.Alert,{actions:[{title:"Закрыть",autoclose:!0,style:"cancel"}],onClose:()=>P(null)},a.createElement("h2",null,e),a.createElement("p",null,t)))},headerVisible:e=>{v({header:e})}};return a.createElement(o.View,{id:s,activePanel:u,history:m,popout:w,header:y,onSwipeBack:window.history.back.bind(window.history)},a.Children.map(c,e=>a.cloneElement(e,{id:e.props.id,navigator:{...f,params:e.props.id===u?{...b,pageParams:p}:{}}})))},e.Stack=function({activePage:e,modals:n=[],children:i,modal:r,disabledConfigProvider:d,webviewType:s,scheme:c,isWebView:p,transitionMotionEnabled:u,appearance:h}){const[{modalHistory:m,activeModal:w,modalParams:b,activePage:y,pageParams:v},g]=a.useReducer((e,a)=>({...e,...a}),{activePage:e,activeModal:null,modalHistory:[],modalParams:{},pageParams:{}}),P=(e,a)=>{t.send("VKWebAppDisableSwipeBack",{}),g({activePage:e,pageParams:a})},k=(e,a)=>{g({activeModal:e,modalHistory:m.includes(e)?m.splice(0,m.indexOf(e)+1):[...m,e],modalParams:a})},f=()=>{g({activeModal:null,modalHistory:[]})},E={goPage:P,showModal:k,hideModal:f},M=a.createElement(o.Root,{activeView:y,modal:0===n.length?null:a.createElement(o.ModalRoot,{activeModal:w,children:a.Children.map(n,e=>a.cloneElement(e,{...e.props,onClose:window.history.back.bind(window.history),header:a.createElement(o.ModalPageHeader,{left:o.platform()===o.ANDROID&&a.createElement(o.PanelHeaderButton,{onClick:window.history.back.bind(window.history),children:a.createElement(l.Icon24Cancel,null)}),right:o.platform()===o.IOS&&a.createElement(o.PanelHeaderButton,{onClick:window.history.back.bind(window.history),children:a.createElement(l.Icon24Dismiss,null)}),children:e.props.title||""}),navigator:{...E,params:e.props.id===w?b:{}}}))})},a.Children.map(i,e=>a.cloneElement(e,{id:e.props.id,showModal:k,hideModal:f,goPage:P,isModalOpen:null!==w,pageParams:v})));return d?M:a.createElement(o.ConfigProvider,{webviewType:s,isWebView:p,scheme:c,transitionMotionEnabled:u,appearance:h},M)},e.Tabbar=function({activeStory:e,id:t,children:l,showModal:n,hideModal:i,goPage:r,isModalOpen:d,pageParams:s}){const[{activeStory:c},p]=a.useReducer((e,a)=>({...e,...a}),{activeStory:e}),u=({currentTarget:e})=>{p({activeStory:e.dataset.story})};return a.createElement(o.Epic,{id:t,activeStory:c,tabbar:(h=l,a.createElement(o.Tabbar,null,a.Children.map(h,(e,t)=>a.createElement(o.TabbarItem,{key:t,onClick:u,selected:c===e.props.id,"data-story":e.props.id,text:e.props.title||"",children:e.props.icon||null,label:e.props.label||""}))))},a.Children.map(l,e=>a.cloneElement(e,{...e.props,goPage:r,showModal:n,hideModal:i,isModalOpen:d,pageParams:s})));var h},Object.defineProperty(e,"__esModule",{value:!0})}));
